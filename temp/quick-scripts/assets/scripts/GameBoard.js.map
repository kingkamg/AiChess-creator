{"version":3,"sources":["GameBoard.js"],"names":["Constant","require","Stone","cc","Class","extends","Component","properties","piecesAtlas","default","type","SpriteAtlas","piecePrefab","Prefab","piecesArrArr","isMyTurn","m_cur_click_stone","onLoad","init32Stones","node","on","Node","EventType","TOUCH_START","e","click_info","get_select_row_col_by_click","row","col","click_stone","m_turn_type","turn_type","red","select_one_stone","console","log","kill_stone","move_stone","bind","pos","convertToNodeSpaceAR","getLocation","Math","floor","y","left_bottom_pos","len_y","cell_size","x","len_x","pre_prefab","m_piecePrefab","stopAllActions","scale","prefab","runAction","repeatForever","sequence","scaleTo","eatBlackStone","m_is_dead","removeFromParent","m_row","m_col","setPosition","game_board_init_info","k","stone_info","stone_type","createOnePieceByName","stone_res_config","stone","addChild","pieceName","piece","instantiate","getComponent","Sprite","spriteFrame","getSpriteFrame"],"mappings":"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","file":"GameBoard.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["/**\n * 功能：游戏棋盘相关逻辑\n */\n\nvar Constant = require('./Constant.js');\nvar Stone = require('./Stone.js');\n\n//\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        \n        //图集资源，用于初始化棋子prefab\n        piecesAtlas: {\n            default: null,\n            type: cc.SpriteAtlas\n        },\n\n        //棋子prefab\n        piecePrefab:{\n            default: null,\n            type: cc.Prefab\n        },\n\n        //二维数组存储棋子数据\n        piecesArrArr:[],\n\n        //是否轮到我下棋了\n        isMyTurn: true,\n\n        //自己点击的棋子\n        m_cur_click_stone: null\n    },\n\n    //组件加载时，进行变量初始化操作\n    onLoad () {\n\n        //初始化32颗棋子\n        this.init32Stones();\n\n        //初始化点击事件\n        this.node.on(cc.Node.EventType.TOUCH_START, function(e){\n\n            if(!this.isMyTurn){\n                return;\n            }\n\n            //\n            var click_info = this.get_select_row_col_by_click(e);\n            var row = click_info.row;\n            var col = click_info.col;\n        \n            //\n            if(row < 0 || row > 9 || col < 0 || col > 8){\n                return;\n            }else{\n                var click_stone = this.piecesArrArr[row][col];\n                \n                //点中了一个棋子\n                if(click_stone){\n\n                    //点了红旗，切换当前选中的棋子\n                    if(click_stone.m_turn_type === Constant.turn_type.red){\n\n                        this.select_one_stone(click_stone);\n                \n                    }\n                    //点了黑棋，1.如果当前没有选中棋子，则报错 2.选中了棋子，则试图吃掉当前的黑棋\n                    else{\n          \n                        if(!this.m_cur_click_stone){\n\n                            console.log(\"-----只能走红棋\");\n\n                        }else{\n\n                            //试图去吃黑色棋子 this.m_cur_click_stone\n\n                            this.kill_stone(row, col);\n                            \n                        }\n                    } \n                }\n                //选中棋子后，又选择了一个空位置\n                else{\n\n                    this.move_stone(row, col);\n                    \n                }\n            }\n\n        }.bind(this), this);\n    },\n\n    //根据点击点获取点击的行列\n    get_select_row_col_by_click: function(e){\n        var pos = this.node.convertToNodeSpaceAR(e.getLocation());\n           \n        var row = Math.floor( (pos.y + Constant.left_bottom_pos.len_y + Constant.cell_size*0.5) / Constant.cell_size);\n        var col = Math.floor( (pos.x + Constant.left_bottom_pos.len_x + Constant.cell_size*0.5) / Constant.cell_size);\n\n        return {\n            row: row,\n            col: col\n        }\n    },\n\n    //选中一颗棋子\n    select_one_stone: function(click_stone){\n\n        if(this.m_cur_click_stone){\n            var pre_prefab = this.m_cur_click_stone.m_piecePrefab;\n            pre_prefab.stopAllActions();\n            pre_prefab.scale = 1;\n        }\n\n        //刷新新的棋子\n        this.m_cur_click_stone = click_stone;\n        var prefab = this.m_cur_click_stone.m_piecePrefab;\n        prefab.stopAllActions();\n        prefab.scale = 1;\n        prefab.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(0.5, 0.8), cc.scaleTo(0.5, 1.0))));\n    },\n\n    //杀死棋子\n    kill_stone: function(row, col){\n        //1.黑棋被吃掉\n        var eatBlackStone = this.piecesArrArr[row][col];\n        eatBlackStone.m_is_dead = true;\n        eatBlackStone.m_piecePrefab.removeFromParent();\n\n        //2.存的的红棋的位置置空\n        this.piecesArrArr[this.m_cur_click_stone.m_row][this.m_cur_click_stone.m_col] = null;\n\n        //3.走棋后修改红旗属性\n        this.m_cur_click_stone.m_row = row;\n        this.m_cur_click_stone.m_col = col;\n\n        //4.修改红旗新的UI位置\n        var x =  col * Constant.cell_size - Constant.left_bottom_pos.len_x\n        var y =  row * Constant.cell_size - Constant.left_bottom_pos.len_y;\n        this.m_cur_click_stone.m_piecePrefab.setPosition(x, y);\n\n        //5.刷新存储\n        this.piecesArrArr[row][col] = this.m_cur_click_stone;\n\n        //6.走完棋后设置当前未选中棋子\n        var prefab = this.m_cur_click_stone.m_piecePrefab;\n        prefab.stopAllActions();\n        prefab.scale = 1;\n        this.m_cur_click_stone = null;\n    },\n\n    //移动棋子\n    move_stone: function(row, col){\n        //1.清理原来位置\n        this.piecesArrArr[this.m_cur_click_stone.m_row][this.m_cur_click_stone.m_col] = null;                 \n\n        //2.设置新的数据\n        this.m_cur_click_stone.m_row = row;\n        this.m_cur_click_stone.m_col = col;\n        this.piecesArrArr[row][col] = this.m_cur_click_stone;\n\n        //3.更新位置\n        var x =  col * Constant.cell_size - Constant.left_bottom_pos.len_x\n        var y =  row * Constant.cell_size - Constant.left_bottom_pos.len_y;\n        this.m_cur_click_stone.m_piecePrefab.setPosition(x, y);\n\n        //4.走完棋子停止动作\n        var prefab = this.m_cur_click_stone.m_piecePrefab;\n        prefab.stopAllActions();\n        prefab.scale = 1;\n        this.m_cur_click_stone = null;\n    },\n\n    //初始化32颗棋子\n    init32Stones: function(){\n\n        //初始化棋子数组信息\n        for(var row = 0; row <= 9; row++){\n            this.piecesArrArr[row] = [];\n            for(var col = 0; col <= 8; col++){\n                this.piecesArrArr[row][col] = null; \n            }\n        }\n\n        //棋子初始化信息\n        var game_board_init_info = Constant.game_board_init_info;\n\n        for(var k in game_board_init_info){\n            var stone_info = game_board_init_info[k];\n\n            var row = stone_info.row;\n            var col = stone_info.col;\n            var turn_type = stone_info.turn_type;\n            var stone_type = stone_info.stone_type;\n            var piecePrefab = this.createOnePieceByName(Constant.stone_res_config[turn_type][stone_type]);\n\n            //创建一颗棋子\n            var stone = new Stone(turn_type, stone_type, false, row, col, piecePrefab); \n            \n            var x =  col * Constant.cell_size - Constant.left_bottom_pos.len_x\n            var y =  row * Constant.cell_size - Constant.left_bottom_pos.len_y;\n            stone.m_piecePrefab.setPosition(x, y);\n            this.node.addChild(stone.m_piecePrefab);\n            \n            //存储棋子信息\n            this.piecesArrArr[row][col] = stone;\n        } \n    },\n\n    //根据棋子名称创建一颗棋子\n    createOnePieceByName: function(pieceName){\n        var piece = cc.instantiate(this.piecePrefab);\n        piece.getComponent(cc.Sprite).spriteFrame = this.piecesAtlas.getSpriteFrame(pieceName);\n        return piece;\n    }\n});\n"]}